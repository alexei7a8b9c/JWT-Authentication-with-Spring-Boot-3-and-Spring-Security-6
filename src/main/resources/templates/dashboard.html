<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–∞—à–±–æ—Ä–¥ - JWT Auth Demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .token-display {
            background-color: #d4edda;
            border: 2px solid #28a745;
            border-radius: 0.375rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            word-break: break-all;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 1rem;
            color: #155724;
            font-weight: 500;
        }
        .copy-btn {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .copy-btn:hover {
            transform: scale(1.05);
        }
        .token-section {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .token-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }
        .card-bg-light {
            background-color: rgba(255, 255, 255, 0.9) !important;
        }
        .token-label {
            color: #155724;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        .logout-btn {
            color: #dc3545 !important;
            border: none;
            background: none;
            padding: 0.5rem 1rem;
            transition: all 0.3s ease;
        }
        .logout-btn:hover {
            color: #fff !important;
            background-color: #dc3545;
            border-radius: 0.375rem;
        }
        .loading-spinner {
            display: none;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/">JWT Auth Demo</a>
        <div class="navbar-nav">
            <a class="nav-link" href="/">–ì–ª–∞–≤–Ω–∞—è</a>
            <a class="nav-link active" href="/dashboard">–î–∞—à–±–æ—Ä–¥</a>
            <a class="nav-link" href="/admin">–ê–¥–º–∏–Ω–∫–∞</a>
            <button class="nav-link btn btn-link text-light text-decoration-none logout-btn"
                    onclick="logout()">
                –í—ã–π—Ç–∏
            </button>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="mb-0">–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h4>
                </div>
                <div class="card-body">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
                    <div th:if="${param.logout}" class="alert alert-info">
                        –í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
                    </div>
                    <div th:if="${param.tokenExpired}" class="alert alert-warning">
                        –°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.
                    </div>

                    <div class="alert alert-success">
                        <h5>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, <span th:text="${username}">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>!</h5>
                        <p>–í—ã —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
                    </div>

                    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏ -->
                    <div class="token-section">
                        <h5>üîê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏</h5>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <div class="card card-bg-light">
                                    <div class="card-body">
                                        <h6 class="token-label">Access Token
                                            <span class="badge token-badge bg-primary">5 –º–∏–Ω</span>
                                        </h6>
                                        <div class="token-display" id="accessTokenDisplay" th:text="${accessToken}">
                                            <!-- Access Token –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-outline-primary btn-sm copy-btn" onclick="copyAccessToken(event)">
                                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å Access
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="toggleAccessTokenVisibility(event)">
                                                üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card card-bg-light">
                                    <div class="card-body">
                                        <h6 class="token-label">Refresh Token
                                            <span class="badge token-badge bg-success">30 –¥–Ω–µ–π</span>
                                        </h6>
                                        <div class="token-display" id="refreshTokenDisplay" th:text="${refreshToken}">
                                            <!-- Refresh Token –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                                        </div>
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-outline-success btn-sm copy-btn" onclick="copyRefreshToken(event)">
                                                üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å Refresh
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm" onclick="toggleRefreshTokenVisibility(event)">
                                                üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                                    <button class="btn btn-warning me-md-2" onclick="refreshTokens()">
                                        <span class="spinner-border spinner-border-sm loading-spinner" id="refreshSpinner"></span>
                                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω—ã
                                    </button>
                                    <button class="btn btn-info me-md-2" onclick="checkTokenStatus()">
                                        üìä –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                                    </button>
                                    <button class="btn btn-outline-light" onclick="showTokenInfo()">
                                        ‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–∞—Ö
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h5>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" onclick="testProtectedEndpoint()">
                                            –¢–µ—Å—Ç –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
                                        </button>
                                        <button class="btn btn-warning" onclick="testAdminEndpoint()">
                                            –¢–µ—Å—Ç –∞–¥–º–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
                                        </button>
                                        <button class="btn btn-info" onclick="getAdminRole()">
                                            –ü–æ–ª—É—á–∏—Ç—å —Ä–æ–ª—å ADMIN
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h5>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h5>
                                    <ul class="list-unstyled small">
                                        <li>üë§ <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span th:text="${username}"></span></li>
                                        <li>üìè <strong>Access Token –¥–ª–∏–Ω–∞:</strong> <span id="accessTokenLength" th:text="${accessToken != null ? accessToken.length() : 0}"></span> —Å–∏–º–≤–æ–ª–æ–≤</li>
                                        <li>üìè <strong>Refresh Token –¥–ª–∏–Ω–∞:</strong> <span id="refreshTokenLength" th:text="${refreshToken != null ? refreshToken.length() : 0}"></span> —Å–∏–º–≤–æ–ª–æ–≤</li>
                                        <li>‚è∞ <strong>Access Token —Å—Ä–æ–∫:</strong> 5 –º–∏–Ω—É—Ç</li>
                                        <li>‚è∞ <strong>Refresh Token —Å—Ä–æ–∫:</strong> 30 –¥–Ω–µ–π</li>
                                    </ul>

                                    <div class="alert alert-info small">
                                        <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> Access Token –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API,
                                        Refresh Token - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <h5>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h5>
                        <div id="apiResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let accessTokenVisible = true;
    let refreshTokenVisible = true;

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Dashboard initialized');

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã
        const accessTokenElement = document.getElementById('accessTokenDisplay');
        const refreshTokenElement = document.getElementById('refreshTokenDisplay');

        if (accessTokenElement && accessTokenElement.textContent) {
            accessTokenElement.setAttribute('data-original', accessTokenElement.textContent);
        }
        if (refreshTokenElement && refreshTokenElement.textContent) {
            refreshTokenElement.setAttribute('data-original', refreshTokenElement.textContent);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤
        updateTokenLengths();
    });

    // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
    async function logout() {
        try {
            console.log('Starting logout process...');

            const logoutBtn = event.target;
            const originalText = logoutBtn.textContent;
            logoutBtn.innerHTML = '<span class="spinner-border spinner-border-sm"></span> –í—ã—Ö–æ–¥...';
            logoutBtn.disabled = true;

            // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è –≤—ã—Ö–æ–¥–∞
            const response = await fetch('/auth/logout', {
                method: 'POST',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json',
                    'X-XSRF-TOKEN': getCsrfToken()
                }
            });

            console.log('Logout response status:', response.status);

            // 2. –í—Å–µ–≥–¥–∞ –æ—á–∏—â–∞–µ–º –∫—É–∫–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
            clearAllCookies();

            // 3. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            window.location.href = '/?logout=true';

        } catch (error) {
            console.error('Logout error:', error);
            // Fallback: –æ—á–∏—â–∞–µ–º –∫—É–∫–∏ –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏–º
            clearAllCookies();
            window.location.href = '/?logout=true';
        }
    }

    function clearAllCookies() {
        const cookies = ['accessToken', 'refreshToken', 'XSRF-TOKEN', 'JSESSIONID'];
        const domains = ['', 'localhost', '127.0.0.1'];

        domains.forEach(domain => {
            cookies.forEach(cookieName => {
                let cookieString = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
                if (domain) {
                    cookieString += ` domain=${domain};`;
                }
                document.cookie = cookieString;
            });
        });
        console.log('All cookies cleared');
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) {
            return parts.pop().split(';').shift();
        }
        return null;
    }

    function getCsrfToken() {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; XSRF-TOKEN=`);
        if (parts.length === 2) {
            return parts.pop().split(';').shift();
        }
        return '';
    }

    function updateTokenLengths() {
        const accessTokenElement = document.getElementById('accessTokenDisplay');
        const refreshTokenElement = document.getElementById('refreshTokenDisplay');
        const accessTokenLengthElement = document.getElementById('accessTokenLength');
        const refreshTokenLengthElement = document.getElementById('refreshTokenLength');

        if (accessTokenElement && accessTokenLengthElement) {
            const accessToken = accessTokenElement.getAttribute('data-original') || accessTokenElement.textContent;
            accessTokenLengthElement.textContent = accessToken.length;
        }

        if (refreshTokenElement && refreshTokenLengthElement) {
            const refreshToken = refreshTokenElement.getAttribute('data-original') || refreshTokenElement.textContent;
            refreshTokenLengthElement.textContent = refreshToken.length;
        }
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Access Token
    function copyAccessToken(event) {
        const tokenElement = document.getElementById('accessTokenDisplay');
        const token = tokenElement.getAttribute('data-original') || tokenElement.textContent;

        navigator.clipboard.writeText(token).then(() => {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            btn.classList.remove('btn-outline-primary');
            btn.classList.add('btn-success');

            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-primary');
            }, 2000);
        }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Access Token', 'error');
        });
    }

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ Refresh Token
    function copyRefreshToken(event) {
        const tokenElement = document.getElementById('refreshTokenDisplay');
        const token = tokenElement.getAttribute('data-original') || tokenElement.textContent;

        navigator.clipboard.writeText(token).then(() => {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
            btn.classList.remove('btn-outline-success');
            btn.classList.add('btn-success');

            setTimeout(() => {
                btn.textContent = originalText;
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-success');
            }, 2000);
        }).catch(err => {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            showAlert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å Refresh Token', 'error');
        });
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ Access Token
    function toggleAccessTokenVisibility(event) {
        const tokenElement = document.getElementById('accessTokenDisplay');
        const btn = event.target;

        if (accessTokenVisible) {
            tokenElement.textContent = '‚Ä¢'.repeat(50) + ' (—Å–∫—Ä—ã—Ç–æ)';
            tokenElement.style.color = '#6c757d';
            tokenElement.style.backgroundColor = '#f8f9fa';
            tokenElement.style.borderColor = '#dee2e6';
            btn.textContent = 'üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å Access Token';
        } else {
            const originalToken = tokenElement.getAttribute('data-original') || '';
            tokenElement.textContent = originalToken;
            tokenElement.style.color = '#155724';
            tokenElement.style.backgroundColor = '#d4edda';
            tokenElement.style.borderColor = '#28a745';
            btn.textContent = 'üëÅÔ∏è –°–∫—Ä—ã—Ç—å Access Token';
        }
        accessTokenVisible = !accessTokenVisible;
    }

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ Refresh Token
    function toggleRefreshTokenVisibility(event) {
        const tokenElement = document.getElementById('refreshTokenDisplay');
        const btn = event.target;

        if (refreshTokenVisible) {
            tokenElement.textContent = '‚Ä¢'.repeat(50) + ' (—Å–∫—Ä—ã—Ç–æ)';
            tokenElement.style.color = '#6c757d';
            tokenElement.style.backgroundColor = '#f8f9fa';
            tokenElement.style.borderColor = '#dee2e6';
            btn.textContent = 'üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å Refresh Token';
        } else {
            const originalToken = tokenElement.getAttribute('data-original') || '';
            tokenElement.textContent = originalToken;
            tokenElement.style.color = '#155724';
            tokenElement.style.backgroundColor = '#d4edda';
            tokenElement.style.borderColor = '#28a745';
            btn.textContent = 'üëÅÔ∏è –°–∫—Ä—ã—Ç—å Refresh Token';
        }
        refreshTokenVisible = !refreshTokenVisible;
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
    async function refreshTokens() {
        const refreshBtn = document.querySelector('button[onclick="refreshTokens()"]');
        const spinner = document.getElementById('refreshSpinner');

        try {
            refreshBtn.disabled = true;
            spinner.style.display = 'inline-block';

            showAlert('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤...', 'info');

            const response = await fetch('/auth/web-refresh', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-XSRF-TOKEN': getCsrfToken()
                },
                credentials: 'include'
            });

            if (response.ok) {
                const data = await response.json();

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
                document.getElementById('accessTokenDisplay').textContent = data.accessToken;
                document.getElementById('refreshTokenDisplay').textContent = data.refreshToken;

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–æ–≤—ã–µ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                document.getElementById('accessTokenDisplay').setAttribute('data-original', data.accessToken);
                document.getElementById('refreshTokenDisplay').setAttribute('data-original', data.refreshToken);

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
                accessTokenVisible = true;
                refreshTokenVisible = true;

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤
                updateTokenLengths();

                showAlert('‚úÖ –¢–æ–∫–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', 'success');
            } else {
                const error = await response.text();
                throw new Error(error);
            }
        } catch (error) {
            console.error('Token refresh error:', error);
            showAlert('‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.', 'error');
        } finally {
            refreshBtn.disabled = false;
            spinner.style.display = 'none';
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤
    async function checkTokenStatus() {
        try {
            showAlert('üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–∫–µ–Ω–æ–≤...', 'info');

            const response = await fetch('/token-info', {
                credentials: 'include'
            });

            const tokenInfo = await response.json();

            if (tokenInfo.error) {
                showAlert('‚ùå ' + tokenInfo.error, 'error');
            } else {
                showAlert(`‚úÖ –°—Ç–∞—Ç—É—Å —Ç–æ–∫–µ–Ω–∞: ${tokenInfo.isValid ? 'VALID' : 'INVALID'}<br>
                üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${tokenInfo.username}<br>
                üìè –î–ª–∏–Ω–∞: ${tokenInfo.length} —Å–∏–º–≤–æ–ª–æ–≤`, 'success');
            }
        } catch (error) {
            console.error('Token status check error:', error);
            showAlert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Ç–æ–∫–µ–Ω–∞', 'error');
        }
    }

    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–∞—Ö
    function showTokenInfo() {
        const accessToken = document.getElementById('accessTokenDisplay').getAttribute('data-original') || '';
        const refreshToken = document.getElementById('refreshTokenDisplay').getAttribute('data-original') || '';

        const info = `
            <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–∞—Ö:</strong><br>
            üîê <strong>Access Token:</strong><br>
            - –î–ª–∏–Ω–∞: ${accessToken.length} —Å–∏–º–≤–æ–ª–æ–≤<br>
            - –°—Ä–æ–∫: 5 –º–∏–Ω—É—Ç<br>
            - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –î–æ—Å—Ç—É–ø –∫ API<br><br>

            üîÑ <strong>Refresh Token:</strong><br>
            - –î–ª–∏–Ω–∞: ${refreshToken.length} —Å–∏–º–≤–æ–ª–æ–≤<br>
            - –°—Ä–æ–∫: 30 –¥–Ω–µ–π<br>
            - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
        `;

        showAlert(info, 'info');
    }

    // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
    async function makeAuthenticatedRequest(url, method = 'GET') {
        const token = getCookie('accessToken');

        const response = await fetch(url, {
            method: method,
            headers: {
                'Authorization': token ? `Bearer ${token}` : '',
                'Content-Type': 'application/json'
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP –æ—à–∏–±–∫–∞! —Å—Ç–∞—Ç—É—Å: ${response.status}`);
        }

        return await response.json();
    }

    function testProtectedEndpoint() {
        document.getElementById('apiResults').innerHTML =
            '<div class="alert alert-info">üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞...</div>';

        makeAuthenticatedRequest('/api/example')
            .then(data => {
                document.getElementById('apiResults').innerHTML =
                    '<div class="alert alert-success">‚úÖ –£—Å–ø–µ—à–Ω–æ!<br>' + JSON.stringify(data, null, 2) + '</div>';
            })
            .catch(error => {
                document.getElementById('apiResults').innerHTML =
                    '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
            });
    }

    function testAdminEndpoint() {
        document.getElementById('apiResults').innerHTML =
            '<div class="alert alert-info">üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞...</div>';

        makeAuthenticatedRequest('/api/example/admin')
            .then(data => {
                document.getElementById('apiResults').innerHTML =
                    '<div class="alert alert-success">‚úÖ –£—Å–ø–µ—à–Ω–æ!<br>' + JSON.stringify(data, null, 2) + '</div>';
            })
            .catch(error => {
                document.getElementById('apiResults').innerHTML =
                    '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ' + error.message +
                    '<br><small>–í–æ–∑–º–æ–∂–Ω–æ, —É –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ ADMIN</small></div>';
            });
    }

    function getAdminRole() {
        document.getElementById('apiResults').innerHTML =
            '<div class="alert alert-info">üîÑ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–∞–≤ ADMIN...</div>';

        makeAuthenticatedRequest('/api/example/get-admin')
            .then(data => {
                document.getElementById('apiResults').innerHTML =
                    '<div class="alert alert-info">‚ÑπÔ∏è ' + data.message +
                    '<br><small>–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –∞–¥–º–∏–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å–Ω–æ–≤–∞</small></div>';
            })
            .catch(error => {
                document.getElementById('apiResults').innerHTML =
                    '<div class="alert alert-danger">‚ùå –û—à–∏–±–∫–∞: ' + error.message + '</div>';
            });
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showAlert(message, type) {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const oldAlerts = document.querySelectorAll('#apiResults .alert');
        oldAlerts.forEach(alert => alert.remove());

        const alertDiv = document.createElement('div');
        alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
        alertDiv.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        const resultsDiv = document.getElementById('apiResults');
        resultsDiv.appendChild(alertDiv);
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>